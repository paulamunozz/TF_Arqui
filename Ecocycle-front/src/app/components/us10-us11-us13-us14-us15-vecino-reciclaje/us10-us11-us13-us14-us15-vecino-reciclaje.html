<h1>Mi Reciclaje</h1>

<!-- Filtros y controles superiores -->
<div class="panelAcciones">
  <!-- Tarjeta de puntaje -->
  <mat-card class="puntaje-card">
    <mat-card-content>
      <span class="puntaje-label">Puntaje acumulado</span>
      <span class="puntaje-value">{{puntajeTotal}}</span>
    </mat-card-content>
  </mat-card>

  <!-- Filtros -->
  <div class="panelFiltros">
    <!-- Filtro Tipo -->
    <mat-form-field appearance="outline" class="columnaFiltro">
      <mat-label>Tipo</mat-label>
      <mat-select [(ngModel)]="filtroTipo" (selectionChange)="aplicarFiltros()">
        <mat-option value="">Todos</mat-option>
        <mat-option value="Vidrio">Vidrio</mat-option>
        <mat-option value="Pl√°stico">Pl√°stico</mat-option>
        <mat-option value="Papel">Papel</mat-option>
        <mat-option value="Electr√≥nicos">Electr√≥nicos</mat-option>
        <mat-option value="Org√°nicos">Org√°nicos</mat-option>
        <mat-option value="Metal/Lata">Metal/Lata</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Filtro M√©todo -->
    <mat-form-field appearance="outline" class="columnaFiltro">
      <mat-label>M√©todo</mat-label>
      <mat-select [(ngModel)]="filtroMetodo" (selectionChange)="aplicarFiltros()">
        <mat-option value="">Todos</mat-option>
        <mat-option value="En centros f√≠sicos de la municipalidad">En centros f√≠sicos de la municipalidad</mat-option>
        <mat-option value="Cami√≥n de reciclaje de la municipalidad">Cami√≥n de reciclaje de la municipalidad</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="columnaFiltro">
      <mat-label>Fecha inicio</mat-label>
      <input matInput [matDatepicker]="pickerMin" [(ngModel)]="fechaMin"
             (dateChange)="aplicarFiltros()" placeholder="MIN">
      <mat-datepicker-toggle matIconSuffix [for]="pickerMin"></mat-datepicker-toggle>
      <mat-datepicker #pickerMin></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="columnaFiltro">
      <mat-label>Fecha fin</mat-label>
      <input matInput [matDatepicker]="pickerMax" [(ngModel)]="fechaMax"
             (dateChange)="aplicarFiltros()" placeholder="MAX">
      <mat-datepicker-toggle matIconSuffix [for]="pickerMax"></mat-datepicker-toggle>
      <mat-datepicker #pickerMax></mat-datepicker>
    </mat-form-field>

    <div class="columnaFiltro columnaBtnFiltro">
      <button type="submit" class="btnFiltro">Filtrar</button>
    </div>
  </div>

  <!-- Bot√≥n Crear -->
  <button class="crearRegistro" (click)="abrirModalCrear()">
    <img
      [src]="imgSrcCrear"
      (mouseenter)="imgSrcCrear='/btn-crear-2.png'"
      (mouseleave)="imgSrcCrear='/btn-crear-1.png'"
      alt="Crear registro"
      class="btnCrear"
    >
    Crear
  </button>
</div>

<!-- Lista de reciclajes -->
<div class="reciclajes-list">
  <!-- Tarjetas de Material -->
  @if (reciclajes.length>0){
    @for (reciclaje of reciclajes; track reciclaje.id) {
      <mat-card class="reciclaje-card">
        <mat-card-content>
          <div class="card-content">
            <div class="card-left">
              <p class="card-info">
                <strong>Peso:</strong> {{ reciclaje.peso }} kg
              </p>
              <p class="card-info">
                <strong>Tipo:</strong> {{ reciclaje.tipo }}
              </p>
            </div>

            <div class="card-center">
              <p class="card-info">
                <strong>Fecha:</strong> {{ reciclaje.fecha | date:'dd/MM/yyyy' }}
              </p>
              <p class="card-info">
                <strong>M√©todo:</strong> {{ reciclaje.metodo }}
              </p>
            </div>

            <div class="card-actions">
              <button mat-icon-button color="primary"
                      (click)="editarReciclaje(reciclaje)"
                      matTooltip="Editar">
                <span class="icon-edit">‚úèÔ∏è</span>
              </button>
              <button mat-icon-button color="warn"
                      (click)="eliminarReciclaje(reciclaje.id)"
                      matTooltip="Eliminar">
                <span class="icon-delete">üóëÔ∏è</span>
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    }
  } @else {
    <p class="sinEventos">
      Tus ciudadanos no han realizado ning√∫n registro<br>
      ¬°Que esperas, crea un evento para animarlos!
    </p>
  }

<!-- Footer contador -->
<footer class="footer">
  <p>Reciclaje registrado: {{ reciclajesFiltrados.length }}</p>
</footer>

<!-- Modal para crear/editar con Material Dialog -->
<div *ngIf="mostrarModal" class="modal-overlay" (click)="cerrarModal()">
  <mat-card class="modal-card" (click)="$event.stopPropagation()">
    <mat-card-header>
      <mat-card-title>
        {{ modoEdicion ? 'Editar Reciclaje' : 'Nuevo Reciclaje' }}
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form (ngSubmit)="guardarReciclaje()" #form="ngForm">
        <!-- Peso -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Peso (kg)</mat-label>
          <input matInput type="number" [(ngModel)]="reciclajeForm.peso"
                 name="peso" step="0.01" required>
        </mat-form-field>

        <!-- Tipo -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tipo</mat-label>
          <mat-select [(ngModel)]="reciclajeForm.tipo" name="tipo" required>
            <mat-option value="Vidrio">Vidrio</mat-option>
            <mat-option value="Pl√°stico">Pl√°stico</mat-option>
            <mat-option value="Papel">Papel</mat-option>
            <mat-option value="Electr√≥nicos">electr√≥nicos</mat-option>
            <mat-option value="Org√°nicos">Org√°nicos</mat-option>
            <mat-option value="Metal/Lata">Metal/Lata</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- M√©todo -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>M√©todo de reciclaje</mat-label>
          <mat-select [(ngModel)]="reciclajeForm.metodo" name="metodo" required>
            <mat-option value="En centros f√≠sicos de la municipalidad">
              En centros f√≠sicos de la municipalidad
            </mat-option>
            <mat-option value="Cami√≥n de reciclaje de la municipalidad">
              Cami√≥n de reciclaje de la municipalidad
            </mat-option>
            <mat-option value="En casa">
              En casa
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Botones -->
        <mat-card-actions class="modal-actions">
          <button class="botonReciclaje btnCancelar" type="button" (click)="cerrarModal()">
            Cancelar
          </button>
          <button class="botonReciclaje btnGuardar" type="submit"
                  [disabled]="!form.valid">
            Guardar
          </button>
        </mat-card-actions>
      </form>
    </mat-card-content>
  </mat-card>
</div>
</div>
